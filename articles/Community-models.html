<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cobrar">
<title>Community models • cobrar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Community models">
<meta property="og:description" content="cobrar">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cobrar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/additional_constraints.html">Working with additional constraints</a>
    <a class="dropdown-item" href="../articles/Community-models.html">Community models</a>
    <a class="dropdown-item" href="../articles/FVA.html">Flux Variability Analysis (FVA)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Waschina/cobrar/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Community models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Waschina/cobrar/blob/HEAD/vignettes/Community-models.Rmd" class="external-link"><code>vignettes/Community-models.Rmd</code></a></small>
      <div class="d-none name"><code>Community-models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Waschina/cobrar" class="external-link">cobrar</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="co">#&gt; cobrar uses...</span></span>
<span><span class="co">#&gt;  - libSBML (v. 5.19.0)</span></span>
<span><span class="co">#&gt;  - glpk (v. 5.0)</span></span></code></pre></div>
<div class="section level2">
<h2 id="merge-models-of-organisms-to-construct-community-metabolic-models">Merge models of organisms to construct community metabolic
models<a class="anchor" aria-label="anchor" href="#merge-models-of-organisms-to-construct-community-metabolic-models"></a>
</h2>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>Microbial cells in multi-species communities frequently engage in
metabolite exchange interactions<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;D’Souza, G., Shitut, S., Preussger, D., Yousif, G.,
Waschina, S. &amp;amp; Kost, C. Ecology and evolution of metabolic
cross-feeding interactions in bacteria. Nat. Prod. Rep. 35, 455–488
(2018).&lt;/p&gt;"><sup>1</sup></a>.</p>
</div>
<div class="section level3">
<h3 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h3>
<p>First, we load the wild type <em>E. coli</em> core metabolic
model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"e_coli_core.xml"</span>, package<span class="op">=</span><span class="st">"cobrar"</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readSBMLmod.html">readSBMLmod</a></span><span class="op">(</span><span class="va">fpath</span><span class="op">)</span></span></code></pre></div>
<p>Next, two single-gene knockout genotypes are generated. For the
example here, we chose the two genes <em>b0720</em> (citrate synthase,
cs) and <em>b0767</em> (6-phosphogluconolactonase, pgl).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_dCS</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmGene.html">rmGene</a></span><span class="op">(</span><span class="va">mod</span>, <span class="st">"b0720"</span><span class="op">)</span></span>
<span><span class="va">mod_dPGL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmGene.html">rmGene</a></span><span class="op">(</span><span class="va">mod</span>, <span class="st">"b0767"</span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to generate a community metabolic model by joining
the two models <code>mod_dCS</code> and <code>mod_dPGL</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/joinModels.html">joinModels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mod_dCS</span>, <span class="va">mod_dPGL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cmod</span></span>
<span><span class="co">#&gt; model ID:                   cobrar-model </span></span>
<span><span class="co">#&gt; model name:                 cobrar-model </span></span>
<span><span class="co">#&gt; number of compartments:     5 </span></span>
<span><span class="co">#&gt;                             M1_e  ( M1 extracellular space )</span></span>
<span><span class="co">#&gt;                             M1_c  ( M1 cytosol )</span></span>
<span><span class="co">#&gt;                             M2_e  ( M2 extracellular space )</span></span>
<span><span class="co">#&gt;                             M2_c  ( M2 cytosol )</span></span>
<span><span class="co">#&gt;                             e  ( shared extracellular space )</span></span>
<span><span class="co">#&gt; number of reactions:        208 </span></span>
<span><span class="co">#&gt; number of metabolites:      164 </span></span>
<span><span class="co">#&gt; number of unique genes:     272 </span></span>
<span><span class="co">#&gt; number of user constraints: 0 </span></span>
<span><span class="co">#&gt; number of subsystems:       0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; objective function:         +1 M1_BIOMASS_Ecoli_core_w_GAM +1 M2_BIOMASS_Ecoli_core_w_GAM</span></span></code></pre></div>
<p>The merged model contains five compartments: an extracellular space
and a cytosol for each organism model M1 (“Δcs”) and M2 (“Δpgl”)), plus
a new shared extracellular space <code>e</code> via which both genotypes
can in principle exchange metabolites (see figure).</p>
<div class="float">
<img src="community.svg" alt="Figure: Commumnity model"><div class="figcaption">
<strong>Figure</strong>: Commumnity model</div>
</div>
<p>Before we predict reaction and exchange fluxes for the community, we
add some additional constraints to the community model, namely flux
coupling constraints. These constraints have the effect, that the
absolute reaction flux bounds of organism x are proportional to the
biomass formation of organism x. For more information on flux coupling,
please see the documentation of the function
<code><a href="../reference/fluxBMCoupling.html">fluxBMCoupling()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fluxBMCoupling.html">fluxBMCoupling</a></span><span class="op">(</span><span class="va">cmod</span>, cpl_c <span class="op">=</span> <span class="fl">200</span>, cpl_u <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>All set. We can now predict the flux distribution within the
community metabolic model, e.g. via the heuristic parsimonious FBA and
store the results in the variable <code>sol</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pfbaHeuristic.html">pfbaHeuristic</a></span><span class="op">(</span><span class="va">cmod</span><span class="op">)</span></span></code></pre></div>
<p>To inspect the predicted growth rate per genotype, we can run:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BMrxn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/guessBMReaction-methods.html">guessBMReaction</a></span><span class="op">(</span><span class="va">cmod</span><span class="op">)</span> <span class="co"># identify the biomass reactions within the community</span></span>
<span><span class="va">growth</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">@</span><span class="va">fluxes</span><span class="op">[</span><span class="fu"><a href="../reference/react_pos-methods.html">react_pos</a></span><span class="op">(</span><span class="va">cmod</span>,<span class="va">BMrxn</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">growth</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">BMrxn</span></span>
<span><span class="va">growth</span></span>
<span><span class="co">#&gt; M1_BIOMASS_Ecoli_core_w_GAM M2_BIOMASS_Ecoli_core_w_GAM </span></span>
<span><span class="co">#&gt;                   0.4533128                   0.3778828</span></span></code></pre></div>
<p>Please note, that the organisms within the community are numbered
consecutively in the same order as the models are supplied to the
<code>joinModels(...)</code> function.</p>
</div>
<div class="section level3">
<h3 id="analysis-of-metabolic-interchange">Analysis of metabolic interchange<a class="anchor" aria-label="anchor" href="#analysis-of-metabolic-interchange"></a>
</h3>
<p>Finally, we are interested in the metabolic interactions between both
genotypes. To extract cross-feeding information from the flux
prediction, we can inspect the flux rates of the organism exchange
reactions (see figure above). Metabolites, which have non-zero flux
rates for both respective organism exchange reactions and where the
signs of predicted fluxes are different, are metabolites that are
exchanged between both community members.</p>
<p>First, a data frame is constructed that contains all organism
exchange reaction IDs, names, predicted fluxes, and the corresponding
organism Index (M1 or M2).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfCF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>exrxn <span class="op">=</span> <span class="va">cmod</span><span class="op">@</span><span class="va">react_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^M[1|2]_EX_"</span>, <span class="va">cmod</span><span class="op">@</span><span class="va">react_id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">dfCF</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">dfCF</span><span class="op">$</span><span class="va">exrxn</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dfCF</span><span class="op">$</span><span class="va">rxnname</span> <span class="op">&lt;-</span> <span class="va">cmod</span><span class="op">@</span><span class="va">react_name</span><span class="op">[</span><span class="fu"><a href="../reference/react_pos-methods.html">react_pos</a></span><span class="op">(</span><span class="va">cmod</span>, <span class="va">dfCF</span><span class="op">$</span><span class="va">exrxn</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dfCF</span><span class="op">$</span><span class="va">flux</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">@</span><span class="va">fluxes</span><span class="op">[</span><span class="fu"><a href="../reference/react_pos-methods.html">react_pos</a></span><span class="op">(</span><span class="va">cmod</span>, <span class="va">dfCF</span><span class="op">$</span><span class="va">exrxn</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Next we split the data frame by organism:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfCF_M1</span> <span class="op">&lt;-</span> <span class="va">dfCF</span><span class="op">[</span><span class="va">dfCF</span><span class="op">$</span><span class="va">model</span> <span class="op">==</span> <span class="st">"M1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rxnname"</span>,<span class="st">"flux"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dfCF_M2</span> <span class="op">&lt;-</span> <span class="va">dfCF</span><span class="op">[</span><span class="va">dfCF</span><span class="op">$</span><span class="va">model</span> <span class="op">==</span> <span class="st">"M2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rxnname"</span>,<span class="st">"flux"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Finally, both data frames are merged in a way, that each row
represents a metabolite and with two flux columns, one for the exchange
reaction rates for each genotype. The re-organised data frame makes it
easy to spot cross-fed metabolites.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfCF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dfCF_M1</span>, <span class="va">dfCF_M2</span>, by <span class="op">=</span> <span class="st">"rxnname"</span>, suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".dCS"</span>,<span class="st">".dPGL"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfCF</span></span>
<span><span class="co">#&gt;                    rxnname   flux.dCS  flux.dPGL</span></span>
<span><span class="co">#&gt; 1  2-Oxoglutarate exchange  -1.299013   1.299013</span></span>
<span><span class="co">#&gt; 2    Acetaldehyde exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 3         Acetate exchange   5.224706  -5.224706</span></span>
<span><span class="co">#&gt; 4         Ammonia exchange  -2.471824  -2.060519</span></span>
<span><span class="co">#&gt; 5             CO2 exchange  11.864378  12.763680</span></span>
<span><span class="co">#&gt; 6      D-Fructose exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 7       D-Glucose exchange  -5.851613  -4.148387</span></span>
<span><span class="co">#&gt; 8       D-lactate exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 9         Ethanol exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 10        Formate exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 11       Fumarate exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 12             H+ exchange  11.720134   4.953649</span></span>
<span><span class="co">#&gt; 13            H2O exchange  12.568463  18.114355</span></span>
<span><span class="co">#&gt; 14    L-Glutamate exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 15    L-Glutamine exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 16       L-Malate exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 17             O2 exchange -10.041290 -13.625823</span></span>
<span><span class="co">#&gt; 18      Phosphate exchange  -1.667602  -1.390117</span></span>
<span><span class="co">#&gt; 19       Pyruvate exchange   0.000000   0.000000</span></span>
<span><span class="co">#&gt; 20      Succinate exchange   0.000000   0.000000</span></span></code></pre></div>
<p>The output shows, that the “Δcs” genotype produces acetate and
consumes 2-oxoglutarate, while the “Δpgl” consumes acetate and produced
2-oxoglutarate.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Silvio Waschina, Johannes Zimmermann, Sina Zimmermann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
